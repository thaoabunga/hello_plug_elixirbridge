const fs = require('fs-promise')

module.exports = function(apps) {return __async(function*(){
  let pkg
  try {
    const json = yield fs.readFile('package.json')
    pkg = JSON.parse(json)
  } catch (err) {
    pkg = {}
  }

  return apps
    .map(([name, deps]) => {
      deps = deps.slice().sort((a, b) => {
        return b.created - a.created
      })
      return [name, deps]
    })
    .sort(([nameA, depsA], [nameB, depsB]) => {
      if (pkg.name === nameA) {
        return -1
      }

      if (pkg.name === nameB) {
        return 1
      }

      return depsB[0].created - depsA[0].created
    })
}())}

function __async(g){return new Promise(function(s,j){function c(a,x){try{var r=g[x?"throw":"next"](a)}catch(e){j(e);return}r.done?s(r.value):Promise.resolve(r.value).then(c,d)}function d(e){c(e,1)}c()})}
